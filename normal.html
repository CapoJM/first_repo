<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Ley débil de los grandes números</title>
    <script type="text/javascript" src="d3/d3.v4.js"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
    <link rel="stylesheet" href="hist.css">
  </head>
  <body>
    <h1>Ley de los grandes números</h1>
    <p>La ley de los grandes números establece que si tenemos una sucesión de
    variables aleatorias independientes y  \( X_i \)</p>

    <script>
      var color = "steelblue";

      // Generate a 1000 data points using normal distribution with mean=20, deviation=5
      var values = d3.range(1000).map(d3.randomNormal(20, 5));

      // A formatter for counts.
      var formatCount = d3.format(",.0f");

      var margin = {top: 20, right: 30, bottom: 30, left: 30},
          width = 960 - margin.left - margin.right,
          height = 500 - margin.top - margin.bottom;

      var max = d3.max(values);
      var min = d3.min(values);
      var x = d3.scaleLinear()
            .domain([min, max])
            .range([0, width]);

      // Generate a histogram using twenty uniformly-spaced bins.
      var data = d3.histogram()
          .domain(x.domain())
          .thresholds(x.ticks(20))
          (values);

      var yMax = d3.max(data, function(d){return d.length});
      var yMin = d3.min(data, function(d){return d.length});
      var colorScale = d3.scaleLinear()
                  .domain([yMin, yMax])
                  .range([d3.rgb(color).brighter(), d3.rgb(color).darker()]);

      var y = d3.scaleLinear()
          .domain([0, yMax])
          .range([height, 0]);

      var xAxis = d3.axisBottom()
          .scale(x);

      var svg = d3.select("body").append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
          .append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      var bar = svg.selectAll(".bar")
          .data(data)
          .enter().append("g")
          .attr("class", "bar")
          .attr("transform", function(d) { return "translate(" + x(d.x0) + "," + y(d.length) + ")"; });

      d3.select("body").append("p").text(data[0]);
      //d3.select("body").append("p").text(values)

      bar.append("rect")
          .attr("x", 1)
          .attr("width", x(data[1].x1) - x(data[1].x0) - 1)
          .attr("height", function(d) { return height - y(d.length); })
          .attr("fill", function(d) { return colorScale(d.length) });

      bar.append("text")
          .attr("dy", ".75em")
          .attr("y", -12)
          .attr("x", (x(data[0].x1) - x(data[0].x0)) / 2)
          .attr("text-anchor", "middle")
          .text(function(d) { return formatCount(d.length); });

      svg.append("g")
          .attr("class", "x axis")
          .attr("transform", "translate(0," + height + ")")
          .call(xAxis);

      /*
      * Adding refresh method to reload new data
      */
      function refresh(values){
        // var values = d3.range(1000).map(d3.random.normal(20, 5));
        var data = d3.histogram()
            .domain(x.domain())
            .thresholds(x.ticks(20))
            (values);

        // Reset y domain using new data
        var yMax = d3.max(data, function(d){return d.length});
        var yMin = d3.min(data, function(d){return d.length});
        y.domain([0, yMax]);
        var colorScale = d3.scaleLinear()
                    .domain([yMin, yMax])
                    .range([d3.rgb(color).brighter(), d3.rgb(color).darker()]);

        var bar = svg.selectAll(".bar").data(data);

        // Remove object with data
        bar.exit().remove();

        bar.transition()
          .duration(1000)
          .attr("transform", function(d) { return "translate(" + x(d.x0) + "," + y(d.length) + ")"; });

        bar.select("rect")
            .transition()
            .duration(1000)
            .attr("height", function(d) { return height - y(d.length); })
            .attr("fill", function(d) { return colorScale(d.length) });

        bar.select("text")
            .transition()
            .duration(1000)
            .text(function(d) { return formatCount(d.length); });

      }

      // Calling refresh repeatedly.
      setInterval(function() {
        var values = d3.range(1000).map(d3.randomNormal(20, 5));
        refresh(values);
      }, 2000);

      </script>

  </body>
</html>
